<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AutonomiQ Vendor Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Inter", "system-ui", "sans-serif"] },
            colors: {
              primary: {
                50: "#eef4ff",
                100: "#e0eaff",
                200: "#c7d7ff",
                300: "#a4bbff",
                400: "#7b96ff",
                500: "#4f73f5",
                600: "#2157d5",
                700: "#1541a6",
                800: "#0f327f",
                900: "#0a2761",
              },
              steel: {
                50: "#f6f7f9",
                100: "#eceef2",
                200: "#d9dde6",
                300: "#b9c0cf",
                400: "#96a0b2",
                500: "#738198",
                600: "#59667c",
                700: "#485364",
                800: "#36404b",
                900: "#242b34",
              },
              brand: {
                50: "#eef2ff",
                100: "#e0e7ff",
                200: "#c7d2fe",
                300: "#a5b4fc",
                400: "#818cf8",
                500: "#6366f1",
                600: "#4f46e5",
                700: "#4338ca",
                800: "#3730a3",
                900: "#312e81",
              },
              accent: {
                50: "#ecfeff",
                100: "#cffafe",
                200: "#a5f3fc",
                300: "#67e8f9",
                400: "#22d3ee",
                500: "#06b6d4",
                600: "#0891b2",
                700: "#0e7490",
                800: "#155e75",
                900: "#164e63",
              },
            },
          },
        },
        darkMode: "class",
      };
    </script>
    <style>
      html,
      body {
        height: 100%;
      }
      * {
        scrollbar-width: thin;
        scrollbar-color: #9aa4b2 transparent;
      }
      *::-webkit-scrollbar {
        width: 10px;
      }
      *::-webkit-scrollbar-thumb {
        background: #9aa4b2;
        border-radius: 999px;
      }
      *::-webkit-scrollbar-track {
        background: transparent;
      }
      .bg-grid {
        background: radial-gradient(
            1000px 400px at 10% -10%,
            rgba(33, 87, 213, 0.1),
            transparent 60%
          ),
          radial-gradient(
            900px 400px at 110% 10%,
            rgba(115, 129, 152, 0.08),
            transparent 70%
          ),
          linear-gradient(
            180deg,
            rgba(246, 247, 249, 0.95),
            rgba(246, 247, 249, 0.65)
          );
      }
      .dark .bg-grid {
        background: radial-gradient(
            1000px 400px at 10% -10%,
            rgba(79, 115, 245, 0.18),
            transparent 60%
          ),
          radial-gradient(
            900px 400px at 110% 10%,
            rgba(54, 64, 75, 0.35),
            transparent 70%
          ),
          linear-gradient(180deg, #181f2b, #181f2b);
      }
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>
  <body class="bg-grid text-steel-900 dark:text-steel-100 dark:bg-steel-900/80">
    <div class="min-h-full flex">
      <div class="flex-1 flex flex-col">
        <header
          class="sticky top-0 z-30 backdrop-blur-md bg-white/70 dark:bg-steel-900/70 border-b border-steel-100 dark:border-steel-800"
        >
          <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="h-16 flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div
                  class="h-8 w-8 rounded-full bg-primary-600 flex items-center justify-center text-white shadow-lg"
                >
                  <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor">
                    <path
                      d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm0 2a8 8 0 0 1 7.529 5.5H16.5a4.5 4.5 0 0 0-9 0H4.47A8 8 0 0 1 12 4Zm0 16a8 8 0 0 1-7.53-5.5H7.5a4.5 4.5 0 0 0 9 0h3a8 8 0 0 1-7.5 5.5Z"
                    />
                  </svg>
                </div>
                <div class="text-lg font-extrabold leading-tight">
                  Procurement Agent
                </div>
              </div>
              <div class="flex items-center gap-1" id="roleTabs"></div>
            </div>
          </div>
        </header>

        <main class="flex-1">
          <div class="max-w-[1600px] mx-auto p-4 md:p-6 lg:p-8">
            <div id="app-container"></div>
          </div>
        </main>
      </div>
    </div>

    <script>
      // =================================================================================
      // === 1. GLOBAL STATE AND API CONFIGURATION
      // =================================================================================
      const API_BASE_URL = "http://127.0.0.1:8000";

      const appState = {
        role: "User",
        isLoading: true,
        user: {
          requests: [],
          conversation: { state: null, messages: [], isComplete: false },
          pendingReviewRequest: null,
        },
        admin: {
          newRequests: [],
          allRequests: [],
          templates: [],
          activeRequirement: null,
          activeRequirementStep: "Validate",
          vendorSearchResults: [],
          quotes: [],
        },
        vendor: {
          activeVendorId: 1,
          invitations: [],
        },
      };

      // =================================================================================
      // === 2. API HELPER FUNCTION
      // =================================================================================
      async function apiCall(endpoint, method = "GET", body = null) {
        const options = {
          method,
          headers: { "Content-Type": "application/json" },
        };
        if (body) options.body = JSON.stringify(body);
        try {
          const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(
              errorData.detail || `API Error: ${response.status}`
            );
          }
          if (
            response.status === 204 ||
            response.headers.get("content-length") === "0"
          )
            return null;
          return await response.json();
        } catch (error) {
          console.error(`API call failed for ${method} ${endpoint}:`, error);
          toast(error.message, "error");
          throw error;
        }
      }

      // =================================================================================
      // === 3. CORE APPLICATION LOGIC
      // =================================================================================
      document.addEventListener("DOMContentLoaded", () => setRole("User"));

      async function setRole(role) {
        appState.role = role;
        appState.isLoading = true;
        render(); // Show loading state
        await fetchDataForRole(role);
        appState.isLoading = false;
        render();
      }

      async function fetchDataForRole(role) {
        try {
          switch (role) {
            case "User":
              const userRequests = await apiCall("/requirements");
              appState.user.requests = userRequests;
              appState.user.pendingReviewRequest =
                userRequests.find(
                  (r) => r.status === "SentForUserConfirmation"
                ) || null;
              break;
            case "Admin":
              appState.admin.activeRequirement = null; // Reset detail view
              [
                appState.admin.newRequests,
                appState.admin.allRequests,
                appState.admin.templates,
              ] = await Promise.all([
                apiCall("/requirements/new"),
                apiCall("/requirements"),
                apiCall("/requirements/templates"),
              ]);
              break;
            case "Vendor":
              appState.vendor.invitations = await apiCall(
                `/rfqs/invitations/${appState.vendor.activeVendorId}`
              );
              break;
          }
        } catch (error) {
          console.error(`Failed to fetch data for role ${role}:`, error);
        }
      }

      function render() {
        const container = document.getElementById("app-container");
        renderRoleTabs();
        if (appState.isLoading) {
          container.innerHTML = `<div class="text-center p-10">Loading...</div>`;
          return;
        }
        switch (appState.role) {
          case "User":
            container.innerHTML = renderUser();
            break;
          case "Admin":
            container.innerHTML = appState.admin.activeRequirement
              ? renderAdminRequestDetail()
              : renderAdminDashboard();
            break;
          case "Vendor":
            container.innerHTML = renderVendor();
            break;
          default:
            container.innerHTML = "<div>Select a role to begin.</div>";
        }
      }

      // =================================================================================
      // === 4. USER VIEW LOGIC & RENDERING
      // =================================================================================

      function renderUser() {
        const reqsToShow = appState.user.requests.filter(
          (r) => r.status !== "SentForUserConfirmation"
        );
        return `
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 space-y-6">
        ${
          appState.user.pendingReviewRequest
            ? renderUserReview(appState.user.pendingReviewRequest)
            : renderUserSubmitContainer()
        }
        ${renderUserRequestsList(reqsToShow)}
      </div>
      <aside class="space-y-6">
        ${renderHowItWorksPanel()}
        ${renderQuickTipPanel()}
      </aside>
    </section>
  `;
      }

      function renderUserSubmitContainer() {
        return appState.user.conversation.messages.length > 0
          ? renderUserConversation()
          : renderUserSubmitForm();
      }

      function renderUserSubmitForm() {
        return `
    <div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-6">
      <h2 class="text-lg font-semibold mb-4">Submit a Requirement</h2>
      <form onsubmit="handleUserSubmit(event)" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">Requirement details</label>
          <textarea id="user-initial-query" required rows="4" placeholder="e.g. I need a music system for an event on 22nd August" class="w-full rounded-xl border border-steel-200 dark:border-steel-600 bg-white/50 dark:bg-steel-700 px-3 py-2 focus:ring-2 focus:ring-brand-400 outline-none"></textarea>
        </div>
        <div class="flex items-center gap-3 pt-2">
          <button type="submit" class="inline-flex items-center gap-2 rounded-xl bg-brand-600 hover:bg-brand-700 text-white px-4 py-2.5 shadow-soft">Submit</button>
        </div>
      </form>
    </div>
  `;
      }

      function renderUserConversation() {
        return `
      <div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Finalizing Your Requirement</h2>
        <div id="chat-messages" class="space-y-4 mb-4 max-h-96 overflow-y-auto pr-2">
          ${appState.user.conversation.messages
            .map(
              (msg) => `
            <div class="flex ${
              msg.type === "human" ? "justify-end" : "justify-start"
            }">
              <div class="max-w-md p-3 rounded-lg ${
                msg.type === "human"
                  ? "bg-brand-600 text-white"
                  : "bg-steel-100 dark:bg-steel-700"
              }">
                ${msg.content.replace(/\n/g, "<br>")}
              </div>
            </div>
          `
            )
            .join("")}
        </div>
        ${
          !appState.user.conversation.isComplete
            ? `
          <form onsubmit="handleUserConversationTurn(event)" class="flex items-center gap-2">
            <input id="user-chat-input" type="text" placeholder="Type your answer..." required class="w-full rounded-xl border border-steel-200 dark:border-steel-600 bg-white/50 dark:bg-steel-700 px-3 py-2 focus:ring-2 focus:ring-brand-400 outline-none">
            <button type="submit" class="rounded-xl bg-brand-600 hover:bg-brand-700 text-white px-4 py-2.5">Send</button>
          </form>
        `
            : ""
        }
      </div>
    `;
      }

      async function handleUserSubmit(event) {
        event.preventDefault();
        const userInput = document.getElementById("user-initial-query").value;
        if (!userInput) return;

        appState.user.conversation = {
          state: null,
          messages: [{ type: "human", content: userInput }],
          isComplete: false,
        };
        render();

        try {
          const data = await apiCall("/requirements/converse", "POST", {
            user_input: userInput,
            state: null,
          });
          appState.user.conversation.state = data.state;
          appState.user.conversation.messages.push({
            type: "agent",
            content: data.response,
          });
          appState.user.conversation.isComplete = data.is_complete;
          if (data.is_complete) {
            appState.user.conversation.messages = [];
            appState.user.conversation.state = null;
            await fetchDataForRole("User");
          }
        } catch (error) {
          appState.user.conversation.messages.push({
            type: "agent",
            content: "Sorry, an error occurred. Please refresh and try again.",
          });
        }
        render();
      }

      async function handleUserConversationTurn(event) {
        event.preventDefault();
        const inputEl = document.getElementById("user-chat-input");
        const userInput = inputEl.value;
        if (!userInput) return;

        appState.user.conversation.messages.push({
          type: "human",
          content: userInput,
        });
        inputEl.value = "";
        render();

        try {
          const data = await apiCall("/requirements/converse", "POST", {
            user_input: userInput,
            state: appState.user.conversation.state,
          });
          appState.user.conversation.state = data.state;
          appState.user.conversation.messages.push({
            type: "agent",
            content: data.response,
          });
          appState.user.conversation.isComplete = data.is_complete;

          if (data.is_complete) {
            setTimeout(async () => {
              appState.user.conversation.messages = [];
              appState.user.conversation.state = null;
              await fetchDataForRole("User");
              render();
            }, 2000);
          }
        } catch (error) {
          appState.user.conversation.messages.push({
            type: "agent",
            content: "Sorry, an error occurred.",
          });
        }
        render();
      }

      function renderUserReview(req) {
        // This function and its handler are now fully API-driven
        const fullReq = appState.user.requests.find((r) => r.id === req.id); // Get full details
        return `
    <div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-6">
      <div class="flex items-center justify-between mb-2"><h2 class="text-lg font-semibold">Review and Confirm</h2>${statusBadge(
        req.status
      )}</div>
      <p class="text-sm text-slate-600 dark:text-slate-300 mb-4">Admin finalized these items. Please confirm or request changes.</p>
      <div class="bg-slate-50 dark:bg-steel-700 border border-slate-200 dark:border-steel-600 rounded-xl p-3 mb-4">
        <div class="text-xs text-slate-500 dark:text-slate-400 mb-1">Original request</div>
        <div class="text-sm">${req.initial_query}</div>
      </div>
      <div class="mb-4">
        <div class="text-sm font-medium mb-2">Finalized items</div>
        <div class="flex flex-wrap gap-2">
          ${(fullReq?.finalized_items || [])
            .map(
              (item) =>
                `<span class="inline-flex items-center gap-1 bg-emerald-50 text-emerald-900 border border-emerald-200 px-2 py-1 rounded-full text-xs">${item}</span>`
            )
            .join("")}
        </div>
      </div>
      <div class="space-y-3">
        <div><label class="block text-sm font-medium mb-1">Add a comment (optional)</label><input id="user-confirm-comment" type="text" placeholder="Looks good!" class="w-full rounded-xl border-steel-200 dark:border-steel-600 bg-white/50 dark:bg-steel-700 px-3 py-2 focus:ring-2 focus:ring-brand-400 outline-none" /></div>
        <div class="flex flex-wrap items-center gap-3">
          <button onclick="handleUserConfirmation(${
            req.id
          }, 'approve')" class="rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2.5">Approve</button>
          <button onclick="handleUserConfirmation(${
            req.id
          }, 'request_changes')" class="rounded-xl bg-amber-500 hover:bg-amber-600 text-white px-4 py-2.5">Request Changes</button>
        </div>
      </div>
    </div>
  `;
      }

      async function handleUserConfirmation(reqId, action) {
        const comment = document.getElementById("user-confirm-comment").value;
        if (action === "request_changes" && !comment)
          return toast(
            "A comment is required when requesting changes.",
            "error"
          );
        try {
          await apiCall(`/requirements/${reqId}/confirm`, "POST", {
            action,
            comment,
          });
          toast(
            action === "approve"
              ? "Requirement approved!"
              : "Change request sent."
          );
          appState.user.pendingReviewRequest = null;
          await fetchDataForRole("User");
          render();
        } catch (error) {}
      }

      function renderUserRequestsList(requests) {
        return `
    <div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-5">
      <div class="flex items-center justify-between mb-3"><h3 class="font-semibold">My Requests</h3><span class="text-xs text-slate-500 dark:text-slate-400">${
        requests.length
      } total</span></div>
      <div class="divide-y divide-slate-100 dark:divide-steel-700">
        ${
          requests.length === 0
            ? `<div class="py-8 text-center text-slate-500 dark:text-slate-400">No active requests.</div>`
            : requests
                .map(
                  (r) => `
            <div class="py-3 flex items-center justify-between gap-3">
              <div class="min-w-0"><div class="font-medium truncate">${
                r.title || "Requirement"
              }</div><div class="text-xs text-slate-500 dark:text-slate-400 truncate">${
                    r.initial_query
                  }</div></div>
              <div class="flex items-center gap-2">${statusBadge(
                r.status
              )}<button onclick="viewRequestDetails(${
                    r.id
                  })" class="text-brand-600 hover:text-brand-700 text-sm font-medium">View</button></div>
            </div>
          `
                )
                .join("")
        }
      </div>
    </div>
  `;
      }

      async function viewRequestDetails(reqId) {
        try {
          const req = await apiCall(`/requirements/${reqId}`);
          // For now, just show a simple alert. A real app would open a modal.
          alert(
            `Status: ${req.status}\nTitle: ${req.title}\nInitial Query: ${req.initial_query}`
          );
        } catch (e) {}
      }

      // --- Static Panels ---
      function renderHowItWorksPanel() {
        return `<div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-5"><h3 class="font-semibold mb-2">How this works</h3><ol class="text-sm text-slate-600 dark:text-slate-300 space-y-2 list-decimal list-inside"><li>Describe your requirement.</li><li>Agent asks clarifying questions.</li><li>Confirm the final list from the admin.</li><li>Admin finds vendors and handles contracts.</li><li>You rate the service after delivery.</li></ol></div>`;
      }
      function renderQuickTipPanel() {
        return `<div class="bg-gradient-to-br from-brand-100 to-accent-100 dark:from-brand-900/50 dark:to-accent-900/50 rounded-2xl border border-white/50 dark:border-steel-700 shadow-lg p-5"><h3 class="font-semibold text-slate-900 dark:text-white mb-2">Quick tip</h3><p class="text-sm text-slate-700 dark:text-slate-300">Try being specific (e.g., "a laptop under $1000 for video editing") to get faster results from the agent.</p></div>`;
      }

      // =================================================================================
      // === 5. ADMIN VIEW LOGIC & RENDERING
      // =================================================================================

      function renderAdminDashboard() {
        return `
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 space-y-6">
        <div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-5">
          <div class="flex items-center justify-between mb-3"><h3 class="font-semibold">New Requests</h3><span class="text-xs text-slate-500 dark:text-slate-400">${
            appState.admin.newRequests.length
          } waiting</span></div>
          <div class="divide-y divide-slate-100 dark:divide-steel-700">
            ${
              appState.admin.newRequests.length === 0
                ? `<div class="py-10 text-center text-slate-500 dark:text-slate-400">No new requests.</div>`
                : appState.admin.newRequests
                    .map(
                      (r) => `
                <div class="py-3 flex items-center justify-between gap-3">
                  <div class="min-w-0"><div class="font-medium truncate">${
                    r.title
                  }</div><div class="text-xs text-slate-500 dark:text-slate-400 truncate">${
                        r.initial_query
                      }</div></div>
                  <div class="flex items-center gap-2">${statusBadge(
                    r.status
                  )}<button onclick="selectAdminRequest(${
                        r.id
                      })" class="rounded-lg bg-brand-600 hover:bg-brand-700 text-white px-3 py-1.5 text-sm">Open</button></div>
                </div>
              `
                    )
                    .join("")
            }
          </div>
        </div>
        <div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-5">
          <div class="flex items-center justify-between mb-3"><h3 class="font-semibold">All Requests</h3><span class="text-xs text-slate-500 dark:text-slate-400">${
            appState.admin.allRequests.length
          } total</span></div>
          <div class="grid md:grid-cols-2 gap-3">
            ${appState.admin.allRequests
              .map(
                (r) => `
              <div class="rounded-xl border border-slate-100 dark:border-steel-700 bg-white dark:bg-steel-800 p-3 flex flex-col">
                <div class="flex items-center justify-between"><div class="font-medium truncate pr-2">${
                  r.title
                }</div>${statusBadge(r.status)}</div>
                <div class="text-xs text-slate-500 dark:text-slate-400 mt-1 h-8 line-clamp-2">${
                  r.initial_query
                }</div>
                <div class="mt-auto pt-2"><button onclick="selectAdminRequest(${
                  r.id
                })" class="text-brand-600 hover:text-brand-700 text-sm font-medium">Manage</button></div>
              </div>
            `
              )
              .join("")}
          </div>
        </div>
      </div>
      <aside class="space-y-6">
        <div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-5">
          <h3 class="font-semibold mb-2">Requirement History</h3>
          <div class="space-y-3 max-h-96 overflow-auto">
            ${appState.admin.templates
              .map(
                (t) => `
              <div class="rounded-xl border border-slate-100 dark:border-steel-700 bg-slate-50 dark:bg-steel-700/50 p-3">
                <div class="text-sm font-medium">${t.title}</div>
                <div class="text-xs text-slate-600 dark:text-slate-300 line-clamp-2">${t.initial_query}</div>
                <div class="mt-2"><button onclick="handleReuseTemplate(${t.id})" class="rounded-lg bg-slate-900 dark:bg-slate-600 text-white px-3 py-1.5 text-xs">Reuse</button></div>
              </div>
            `
              )
              .join("")}
          </div>
        </div>
        <div class="bg-gradient-to-br from-accent-100 to-brand-100 dark:from-accent-900/50 dark:to-brand-900/50 rounded-2xl border border-white/50 dark:border-steel-700 shadow-lg p-5">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-2">Shortcuts</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="handleCreateBlankRequest()" class="rounded-lg bg-white/70 dark:bg-steel-700 text-slate-900 dark:text-white border border-slate-200 dark:border-steel-600 px-3 py-1.5 text-xs">New blank request</button>
          </div>
        </div>
      </aside>
    </section>
  `;
      }

      function renderAdminRequestDetail() {
        const req = appState.admin.activeRequirement;
        const step = appState.admin.activeRequirementStep;
        const steps = ["Validate", "Vendors", "Quotes", "Contract"];

        // Determine which steps are accessible
        const statusSequence = {
          Submitted: 0,
          InReview: 0,
          SentForUserConfirmation: 0,
          UserConfirmed: 1,
          RFQSent: 2,
          QuotesReceived: 2,
          Shortlisted: 3,
          WinnerSelected: 3,
          ContractSent: 3,
        };
        const currentStatusIndex = statusSequence[req.status] ?? 0;

        let stepContent = "";
        switch (step) {
          case "Validate":
            stepContent = renderAdminValidate(req);
            break;
          case "Vendors":
            stepContent = renderAdminVendors(req);
            break;
          case "Quotes":
            stepContent = renderAdminQuotes(req);
            break;
          case "Contract":
            stepContent = renderAdminContract(req);
            break;
          default:
            stepContent = "<div>Error: Unknown Step</div>";
        }

        return `
      <div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-5">
        <div class="flex items-center justify-between flex-wrap gap-2 mb-3">
          <div>
            <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Managing Request</div>
            <div class="text-lg font-semibold">${req.title}</div>
          </div>
          <div class="flex items-center gap-2">
            ${statusBadge(req.status)}
            <button class="rounded-lg bg-slate-900 dark:bg-slate-600 text-white px-3 py-1.5 text-sm" onclick="appState.admin.activeRequirement=null; render()">Back</button>
          </div>
        </div>
        <div class="flex flex-wrap items-center gap-2 mb-4 border-b border-slate-200 dark:border-steel-700 pb-4">
          ${steps
            .map((s, i) => {
              const isActive = s === step;
              const isAccessible = i <= currentStatusIndex;
              return `<button ${
                isAccessible ? "" : "disabled"
              } onclick="appState.admin.activeRequirementStep='${s}'; render()" class="px-3 py-1.5 rounded-full text-sm font-medium border ${
                isActive
                  ? "bg-brand-600 text-white border-brand-600"
                  : "bg-white dark:bg-steel-700 text-slate-700 dark:text-slate-200 border-slate-200 dark:border-steel-600"
              } ${
                isAccessible
                  ? "hover:bg-slate-50 dark:hover:bg-steel-600"
                  : "opacity-50 cursor-not-allowed"
              }">${s}</button>`;
            })
            .join("")}
        </div>
        <div>${stepContent}</div>
      </div>
    `;
      }
      // --- (Sub-render functions for each admin tab will be here) ---

      // =================================================================================
      // === 6. VENDOR VIEW LOGIC & RENDERING
      // =================================================================================
      function renderVendor() {
        return `<div class="bg-white/80 dark:bg-steel-800 backdrop-blur rounded-2xl border border-steel-200 dark:border-steel-700 shadow-lg p-5">... Vendor UI ...</div>`;
      }

      // =================================================================================
      // === 7. UTILITY & UI HELPER FUNCTIONS
      // =================================================================================
      function renderRoleTabs() {
        /* ... same as before ... */
      }
      function statusBadge(status) {
        /* ... same as before ... */
      }
      function toast(message, type = "success") {
        /* ... same as before ... */
      }
    </script>
  </body>
</html>
